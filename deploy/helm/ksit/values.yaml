# Default values for KSIT
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/namansh70747/ksit-controller
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  name: "ksit-controller-manager"

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  fsGroup: 65532

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

affinity: {}

# Controller configuration
controller:
  # Metrics server bind address
  metricsAddr: ":8080"

  # Health probe bind address
  probeAddr: ":8081"

  # Enable leader election for high availability
  leaderElection: true

  # Reconciliation interval (how often to check health)
  reconcileInterval: 30s

  # Log level (debug, info, warn, error)
  logLevel: info

# Webhook configuration (currently disabled by default)
webhook:
  enabled: false
  port: 9443
  certDir: /tmp/k8s-webhook-server/serving-certs

# RBAC configuration
rbac:
  create: true

# Cluster inventory settings
clusterInventory:
  # Enable automatic cluster discovery
  autoDiscovery: false

# Integration health check configuration
healthCheck:
  # Default health check interval for integrations
  interval: 30s

  # Number of retries before marking integration as failed
  retries: 3

  # Timeout for each health check
  timeout: 10s

# Monitoring settings
monitoring:
  # Enable Prometheus ServiceMonitor
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}

# Alerting configuration (optional)
alerting:
  enabled: false
  # Slack webhook URL for alerts
  slackWebhook: ""
  # PagerDuty integration key
  pagerdutyKey: ""

# Auto-install integrations on target clusters
# When enabled, KSIT will automatically install and monitor these tools
autoInstall:
  # Enable auto-install feature
  enabled: true

  # Target clusters for auto-installation
  targetClusters:
    - cluster-1
    - cluster-2

  # ArgoCD auto-install
  argocd:
    enabled: true
    namespace: argocd
    chart:
      repository: https://argoproj.github.io/argo-helm
      name: argo-cd
      version: "5.51.6"
    values:
      server.service.type: ClusterIP
      server.insecure: "true"

  # Prometheus auto-install
  prometheus:
    enabled: true
    namespace: monitoring
    chart:
      repository: https://prometheus-community.github.io/helm-charts
      name: kube-prometheus-stack
      version: "55.5.0"
    values:
      prometheus.prometheusSpec.retention: 7d

  # Istio auto-install
  istio:
    enabled: true
    namespace: istio-system
    chart:
      repository: https://istio-release.storage.googleapis.com/charts
      name: istiod
      version: "1.20.1"
    values:
      global.hub: docker.io/istio

  # Flux auto-install (manifest-based)
  flux:
    enabled: false # Disabled by default due to kind compatibility
    namespace: flux-system
    manifestUrl: https://github.com/fluxcd/flux2/releases/latest/download/install.yaml
